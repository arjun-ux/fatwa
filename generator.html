<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generate Link Tamu</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-main: #FEFEFE;
      --bg-soft: #EFEDEE;
      --text-main: #2E1E1F;
      --text-soft: #755355;
      --accent-main: #8A7577;
      --accent-soft: #A49292;
      --success: #4CAF50;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: var(--bg-soft);
      color: var(--text-main);
      padding: 40px 20px;
      min-height: 100vh;
    }

    .box {
      max-width: 600px;
      background: var(--bg-main);
      padding: 32px;
      margin: auto;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    h2 {
      font-family: 'Playfair Display', serif;
      font-size: 28px;
      color: var(--accent-main);
      margin: 0 0 24px;
      text-align: center;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 14px;
      color: var(--text-soft);
      margin-bottom: 8px;
      font-weight: 500;
    }

    input, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
      color: var(--text-main);
      transition: border-color 0.3s;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
      line-height: 1.6;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent-main);
    }

    input::placeholder, textarea::placeholder {
      color: #bbb;
    }

    button {
      width: 100%;
      padding: 14px 24px;
      background: var(--accent-main);
      color: #fff;
      border: none;
      border-radius: 30px;
      font-family: 'Poppins', sans-serif;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      margin-top: 8px;
    }

    button:hover {
      background: var(--accent-soft);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
    }

    .result {
      margin-top: 24px;
      padding: 20px;
      background: var(--bg-soft);
      border-radius: 8px;
      display: none;
    }

    .result.show {
      display: block;
      animation: fadeUp 0.3s ease;
    }

    .result strong {
      display: block;
      font-size: 14px;
      color: var(--text-soft);
      margin-bottom: 12px;
    }

    .result-link {
      word-break: break-all;
      font-size: 14px;
      color: var(--accent-main);
      text-decoration: none;
      display: inline-block;
      margin-bottom: 12px;
      padding: 8px 12px;
      background: var(--bg-main);
      border-radius: 4px;
      border: 1px solid #ddd;
    }

    .result-link:hover {
      text-decoration: underline;
    }

    .result-message {
      background: var(--bg-main);
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 12px;
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-main);
      white-space: pre-wrap;
      word-wrap: break-word;
      border: 1px solid #ddd;
    }

    .copy-btn {
      padding: 10px 20px;
      background: var(--success);
      color: #fff;
      border: none;
      border-radius: 6px;
      font-family: 'Poppins', sans-serif;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.3s;
      margin-top: 8px;
    }

    .copy-btn:hover {
      background: #45a049;
    }

    .copy-btn.copied {
      background: var(--accent-main);
    }

    .error {
      color: #d32f2f;
      font-size: 13px;
      margin-top: 4px;
      display: none;
    }

    .error.show {
      display: block;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 20px 10px;
      }

      .box {
        padding: 24px 20px;
      }

      h2 {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>

<div class="box">
  <h2>Generate Link Undangan</h2>

  <div class="form-group">
    <label for="guest">Nama Tamu</label>
    <input type="text" id="guest" placeholder="Contoh: Ahmad Sutrisno" autocomplete="off">
    <div class="error" id="errorGuest">Nama tamu harus diisi</div>
  </div>

  <div class="form-group">
    <label for="baseUrl">Base URL Undangan</label>
    <input type="text" id="baseUrl" value="index.html" placeholder="https://domainanda.com/index.html">
    <div class="error" id="errorUrl">Base URL harus diisi</div>
  </div>

  <div class="form-group">
    <label for="invitationMessage">Pesan Undangan</label>
    <textarea id="invitationMessage">Assalamu'alaikum Warahmatullahi Wabarakatuh

Kepada Yth.
[nama]

Dengan memohon rahmat dan ridho Allah SWT, kami bermaksud mengundang Bapak/Ibu/Saudara/i untuk menghadiri acara pernikahan kami.

Silakan klik link berikut untuk membuka undangan digital:
</textarea>
  </div>

  <button onclick="generate()" id="generateBtn">Generate Link</button>

  <div class="result" id="result">
    <strong>Preview Pesan + Link:</strong>
    <div class="result-message" id="resultMessage"></div>
    <strong>Link Undangan:</strong>
    <a href="#" id="resultLink" class="result-link" target="_blank"></a>
    <br>
    <button class="copy-btn" onclick="copyLink()" id="copyBtn">Salin Pesan & Link</button>
  </div>
</div>

<script>
  // Support Enter key (Ctrl+Enter for textarea)
  document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
      input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          generate();
        }
      });
    });

    const textarea = document.getElementById('invitationMessage');
    textarea.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && e.ctrlKey) {
        generate();
      }
    });
  });

  function generate() {
    const guest = document.getElementById('guest').value.trim();
    const baseUrl = document.getElementById('baseUrl').value.trim();
    const invitationMessage = document.getElementById('invitationMessage').value.trim();
    const errorGuest = document.getElementById('errorGuest');
    const errorUrl = document.getElementById('errorUrl');
    const result = document.getElementById('result');
    const resultLink = document.getElementById('resultLink');
    const resultMessage = document.getElementById('resultMessage');

    // Reset errors
    errorGuest.classList.remove('show');
    errorUrl.classList.remove('show');

    // Validation
    let hasError = false;
    if (!guest) {
      errorGuest.classList.add('show');
      hasError = true;
    }
    if (!baseUrl) {
      errorUrl.classList.add('show');
      hasError = true;
    }

    if (hasError) {
      result.classList.remove('show');
      return;
    }

    // Build URL - handle relative and absolute URLs
    let finalUrl = baseUrl;
    // Convert relative URLs to absolute for display purposes
    if (!finalUrl.startsWith('http://') && !finalUrl.startsWith('https://')) {
      // For relative paths, use current location
      const currentHost = window.location.origin;
      const currentPath = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
      if (finalUrl.startsWith('/')) {
        finalUrl = currentHost + finalUrl;
      } else if (finalUrl.startsWith('./')) {
        finalUrl = currentHost + currentPath + finalUrl.substring(2);
      } else {
        finalUrl = currentHost + currentPath + finalUrl;
      }
    }

    // Add query parameter
    const separator = finalUrl.includes('?') ? '&' : '?';
    const link = finalUrl + separator + 'to=' + encodeURIComponent(guest);

    // Build message with link
    let messageToCopy = invitationMessage;
    if (messageToCopy) {
      // Replace [nama] placeholder with guest name if exists
      messageToCopy = messageToCopy.replace(/\[nama\]/gi, guest);
      messageToCopy = messageToCopy + '\n\n' + link;
    } else {
      messageToCopy = link;
    }

    // Display result
    resultLink.href = link;
    resultLink.textContent = link;
    resultMessage.textContent = messageToCopy;
    result.classList.add('show');

    // Store message for copying
    result.dataset.messageToCopy = messageToCopy;

    // Reset copy button
    const copyBtn = document.getElementById('copyBtn');
    copyBtn.textContent = 'Salin Pesan & Link';
    copyBtn.classList.remove('copied');

    // Scroll to result
    result.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }

  function copyLink() {
    const result = document.getElementById('result');
    const messageToCopy = result.dataset.messageToCopy || '';
    const copyBtn = document.getElementById('copyBtn');

    if (!messageToCopy) {
      alert('Silakan generate link terlebih dahulu');
      return;
    }

    // Copy to clipboard
    navigator.clipboard.writeText(messageToCopy).then(function() {
      copyBtn.textContent = '✓ Tersalin!';
      copyBtn.classList.add('copied');
      setTimeout(function() {
        copyBtn.textContent = 'Salin Pesan & Link';
        copyBtn.classList.remove('copied');
      }, 2000);
    }).catch(function(err) {
      // Fallback for older browsers
      const textarea = document.createElement('textarea');
      textarea.value = messageToCopy;
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand('copy');
        copyBtn.textContent = '✓ Tersalin!';
        copyBtn.classList.add('copied');
        setTimeout(function() {
          copyBtn.textContent = 'Salin Pesan & Link';
          copyBtn.classList.remove('copied');
        }, 2000);
      } catch (err) {
        alert('Gagal menyalin. Silakan salin manual dari preview di atas.');
      }
      document.body.removeChild(textarea);
    });
  }
</script>

</body>
</html>
